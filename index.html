<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JK CHOPP ‚Äî Sistema Interno</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Estilos adicionais para garantir compatibilidade */
    .sidebar {
      position: fixed;
      top: 0;
      left: -320px;
      width: 320px;
      height: 100%;
      background: var(--panel);
      border-right: 1px solid var(--bd-soft);
      transition: left 0.3s ease;
      z-index: 1000;
      display: flex;
      flex-direction: column;
    }
    
    .sidebar.open {
      left: 0;
    }
    
    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid var(--bd-soft);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .sidebar-nav {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    
    .sidebar-footer {
      padding: 20px;
      border-top: 1px solid var(--bd-soft);
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 15px;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--brand);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    
    /* Garantir que os modais funcionem em todos os navegadores */
    dialog {
      border: 1px solid var(--bd-soft);
      border-radius: 16px;
      padding: 0;
      background: var(--card);
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      min-width: 500px;
      max-width: 90vw;
    }
    
    dialog::backdrop {
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px);
    }
    
    /* Estados para tags de status */
    .status-aberto { background: #1e3a8a; color: #dbeafe; }
    .status-andamento { background: #854d0e; color: #fef3c7; }
    .status-concluido { background: #166534; color: #dcfce7; }
    .status-cancelado { background: #991b1b; color: #fecaca; }
    
    /* Loading states */
    .btn:disabled {
      position: relative;
      opacity: 0.7;
      cursor: not-allowed;
    }
    
    .btn:disabled::after {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      animation: loading 1.5s infinite;
    }
    
    @keyframes loading {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    /* Melhorias de responsividade */
    @media (max-width: 768px) {
      dialog {
        min-width: auto;
        width: 95vw;
        margin: 2.5vw;
      }
      
      .topbar .left .title h1 {
        font-size: 16px;
      }
      
      .top-actions {
        justify-content: center;
        width: 100%;
        margin-top: 10px;
      }
      
      .top-actions .btn {
        flex: 1;
        min-width: 120px;
        justify-content: center;
      }
    }
    
    @media (max-width: 480px) {
      .sidebar {
        width: 100%;
        left: -100%;
      }
      
      .brand .title h1 {
        font-size: 14px;
      }
      
      .brand .title small {
        font-size: 10px;
      }
    }

    /* Estilos para o novo sistema de pedidos */
    .novo-pedido-agendamento {
      max-width: 100%;
      margin: 0 auto;
    }

    .pedido-header {
      background: var(--card);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid var(--bd-soft);
    }

    .form-section {
      background: var(--card);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 16px;
      border: 1px solid var(--bd-soft);
    }

    .form-section.hidden {
      display: none;
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--bd-soft);
    }

    .section-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background: var(--brand);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }

    .form-grid .span-2 {
      grid-column: span 2;
    }

    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-switch .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--input);
      transition: .2s;
      border-radius: 24px;
    }

    .toggle-switch .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .2s;
      border-radius: 50%;
    }

    .toggle-switch input:checked + .slider {
      background-color: var(--brand);
    }

    .toggle-switch input:checked + .slider:before {
      transform: translateX(20px);
    }

    /* Selected Items */
    .selected-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: var(--bg);
      border-radius: 8px;
      border: 1px solid var(--bd-soft);
      margin-bottom: 8px;
    }

    .selected-item-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .item-total {
      font-weight: 600;
      color: var(--brand);
    }

    .auto-badge {
      background: var(--info);
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    }

    .equipment-icon {
      font-size: 16px;
    }

    /* Payment Methods */
    .payment-methods-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .payment-method {
      display: block;
      cursor: pointer;
    }

    .payment-method input {
      display: none;
    }

    .payment-content {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      border: 2px solid var(--bd-soft);
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    .payment-method input:checked + .payment-content {
      border-color: var(--brand);
      background: rgba(245, 158, 11, 0.1);
    }

    .payment-icon {
      font-size: 24px;
    }

    .payment-name {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .payment-desc {
      font-size: 12px;
      color: var(--muted);
    }

    /* Payment Details */
    .payment-details {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid var(--success);
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
    }

    .payment-details h5 {
      margin: 0 0 12px 0;
      color: var(--success);
    }

    .details-grid {
      display: grid;
      gap: 8px;
    }

    .details-grid > div {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0;
      border-bottom: 1px solid var(--bd-soft);
    }

    .details-grid > div:last-child {
      border-bottom: none;
    }

    /* Fees */
    .fees-grid {
      display: grid;
      gap: 12px;
      margin-top: 12px;
    }

    .fee-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      border: 1px solid var(--bd-soft);
      border-radius: 8px;
    }

    .fee-label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .fee-input {
      width: 120px;
      text-align: right;
    }

    /* Payment Summary */
    .payment-summary {
      background: var(--panel);
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid var(--bd-soft);
    }

    .payment-summary h5 {
      margin: 0 0 16px 0;
    }

    .summary-grid {
      display: grid;
      gap: 8px;
    }

    .summary-grid > div {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid var(--bd-soft);
    }

    .summary-grid .total {
      border-top: 2px solid var(--bd-soft);
      border-bottom: none;
      font-weight: 600;
      font-size: 18px;
      color: var(--brand);
      margin-top: 8px;
      padding-top: 12px;
    }

    /* Notices */
    .notice {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 16px;
      border-radius: 8px;
      margin: 16px 0;
    }

    .notice.warning {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid var(--warning);
    }

    .notice-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .notice h5 {
      margin: 0 0 4px 0;
      color: var(--warning);
    }

    .notice p {
      margin: 0;
      font-size: 14px;
      color: var(--text);
    }

    /* Auto Barrels */
    .auto-barrels {
      background: var(--panel);
      border-radius: 8px;
      padding: 16px;
      border: 1px solid var(--bd-soft);
    }

    .auto-barrel-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: var(--bg);
      border-radius: 6px;
      margin-bottom: 8px;
    }

    .auto-barrel-item:last-child {
      margin-bottom: 0;
    }

    /* Equipment List */
    .equipment-list {
      background: var(--panel);
      border-radius: 8px;
      padding: 16px;
      border: 1px solid var(--bd-soft);
      min-height: 60px;
    }

    /* Status Badges */
    .status {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .status.agendado { background: #fef3c7; color: #92400e; }
    .status.aguardando { background: #dbeafe; color: #1e40af; }
    .status.confirmado { background: #dcfce7; color: #166534; }
    .status.concluido { background: #dcfce7; color: #166534; }
    .status.cancelado { background: #fee2e2; color: #991b1b; }

    /* Responsive */
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .form-grid .span-2 {
        grid-column: span 1;
      }
      
      .payment-methods-grid {
        grid-template-columns: 1fr;
      }
      
      .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .selected-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .selected-item-actions {
        align-self: flex-end;
      }
      
      .fee-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .fee-input {
        width: 100%;
      }
    }
  </style>
</head>

<body data-theme="dark">
  <div class="app">
    <header>
      <div class="wrap topbar">
        <div class="left">
          <button class="hamburger" id="btnMenu" title="Abrir menu">‚ò∞</button>
          <div class="brand">
            <div class="logo">JK</div>
            <div class="title">
              <h1>JK CHOPP ‚Ä¢ Sistema Interno</h1>
              <small>Gest√£o Completa de Clientes, Pedidos, Estoque e Financeiro</small>
            </div>
          </div>
        </div>

        <div class="row top-actions">
          <button class="btn" id="btnTheme" title="Alternar tema">üåì Tema</button>
          <button class="btn" id="btnExport" title="Exportar backup">‚¨áÔ∏è Exportar</button>
          <label class="btn" for="importFile" title="Importar backup">‚¨ÜÔ∏è Importar</label>
          <input id="importFile" type="file" accept="application/json" class="hidden">
          <button class="btn" id="btnReset" title="Zerar base">üóëÔ∏è Zerar</button>
          <button class="btn" id="btnPerfil" title="Perfil">üë§ Perfil</button>
        </div>
      </div>
    </header>

    <main class="wrap">
      <section id="content">
        <!-- Conte√∫do din√¢mico ser√° injetado aqui via JavaScript -->
      </section>
    </main>

    <footer>
      <div class="wrap footer">
        <span>‚Ä¢ Sistema Completo</span>
        <span>Desenvolvido para JK CHOPP üç∫</span>
      </div>
    </footer>
  </div>

  <!-- MENU LATERAL -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="brand">
        <div class="logo">JK</div>
        <div class="title">
          <h2>JK CHOPP</h2>
          <small>Sistema Interno</small>
        </div>
      </div>
      <button class="btn ghost icon" id="btnCloseMenu" aria-label="Fechar menu">‚úï</button>
    </div>

    <nav class="sidebar-nav" id="sidebarNav">
  <a href="./telafechamen.html" class="menu-item">üìÑ Fechamento</a>
</nav>

    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar">üë§</div>
        <div class="user-details">
          <strong id="userName">Administrador</strong>
          <small id="userEmail">admin@jkchopp.com</small>
        </div>
      </div>
      <button class="btn ghost" id="btnLogout">üö™ Sair</button>
    </div>
  </aside>

  <!-- MODAL NOVO PEDIDO (AGENDAMENTO) -->
  <dialog id="modalNovoPedido">
    <div class="modal-header">
      <h2 id="modalPedidoTitle">üìã Novo Pedido - Agendamento de Entrega</h2>
      <button class="btn ghost icon close" aria-label="Fechar">‚úï</button>
    </div>

    <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
      <div id="novoPedidoContent">
        <!-- Conte√∫do do novo pedido ser√° injetado aqui -->
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn" id="btnCancelarPedido">Cancelar</button>
      <button class="btn success" id="btnFinalizarPedido">üíæ Salvar Pedido</button>
    </div>
  </dialog>

  <!-- MODAL DETALHES DO PEDIDO -->
  <dialog id="modalDetalhesPedido">
    <div class="modal-header">
      <h2>Detalhes do Pedido <span id="ped_det_codigo"></span></h2>
      <button class="btn ghost icon close" aria-label="Fechar">‚úï</button>
    </div>

    <div class="modal-body">
      <div class="stack">
        <div class="info-grid">
          <div><strong>Cliente:</strong> <span id="ped_det_cliente"></span></div>
          <div><strong>Status:</strong> <span id="ped_det_status"></span></div>
          <div><strong>Data:</strong> <span id="ped_det_data"></span></div>
          <div><strong>Total:</strong> <span id="ped_det_total"></span></div>
        </div>

        <h4>Itens do Pedido</h4>
        <div class="table-wrap">
          <table id="tblItensPedidoDet">
            <thead>
              <tr>
                <th>Produto</th>
                <th>Quantidade</th>
                <th>Valor Unit.</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="form-group">
          <label class="form-label">Alterar Status</label>
          <select id="ped_det_status_edit" class="input">
            <option value="aberto">Aberto</option>
            <option value="andamento">Em Andamento</option>
            <option value="concluido">Conclu√≠do</option>
            <option value="cancelado">Cancelado</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Observa√ß√µes</label>
          <textarea id="ped_det_observacoes" class="input" rows="2" readonly></textarea>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn danger" id="btnExcluirPedido">üóëÔ∏è Excluir Pedido</button>
      <button class="btn" id="btnFecharDetalhes">Fechar</button>
      <button class="btn success" id="btnSalvarStatus">üíæ Salvar Status</button>
    </div>
  </dialog>

  <!-- MODAL PERFIL -->
  <dialog id="modalPerfil">
    <div class="modal-header">
      <h2>üë§ Perfil do Usu√°rio</h2>
      <button class="btn ghost icon close" aria-label="Fechar">‚úï</button>
    </div>

    <div class="modal-body">
      <div class="stack">
        <div class="form-group">
          <label class="form-label">Nome Completo</label>
          <input class="input" id="perf_nome" placeholder="Seu nome completo" />
        </div>
        
        <div class="form-group">
          <label class="form-label">E-mail</label>
          <input class="input" id="perf_email" type="email" placeholder="seu@email.com" />
        </div>
        
        <div class="form-group">
          <label class="form-label">Telefone/WhatsApp</label>
          <input class="input" id="perf_telefone" placeholder="(11) 99999-9999" />
        </div>
        
        <div class="form-group">
          <label class="form-label">Nova Senha</label>
          <input class="input" id="perf_senha" type="password" placeholder="Deixe em branco para manter a atual" />
          <small class="muted">M√≠nimo 6 caracteres</small>
        </div>
        
        <div class="form-group">
          <label class="form-label">Confirmar Senha</label>
          <input class="input" id="perf_confirmar_senha" type="password" placeholder="Repita a nova senha" />
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn" id="btnFecharPerfil">Fechar</button>
      <button class="btn success" id="btnSalvarPerfil">üíæ Salvar Altera√ß√µes</button>
    </div>
  </dialog>

  <!-- MODAL CONFIRMA√á√ÉO -->
  <dialog id="modalConfirm">
    <div class="modal-header">
      <h2>Confirma√ß√£o</h2>
      <button class="btn ghost icon close" aria-label="Fechar">‚úï</button>
    </div>

    <div class="modal-body">
      <p id="confirmMessage">Tem certeza que deseja prosseguir com esta a√ß√£o?</p>
    </div>

    <div class="modal-footer">
      <button class="btn" id="btnConfirmCancel">Cancelar</button>
      <button class="btn danger" id="btnConfirmOk">Confirmar</button>
    </div>
  </dialog>

  <!-- SCRIPTS -->
  <!-- 1) Biblioteca do Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- 2) Suas chaves + createClient -->
  <script src="./env.js"></script>

  <!-- 3) Seu app (traz de volta a interface e navega√ß√£o) -->
  <script src="./script.js"></script>

  <!-- 4) (opcional) teste r√°pido da conex√£o -->
  <!--
  <script>
  (async () => {
    const { data, error } = await supabase.from('pessoas').select('id').limit(1);
    if (error) console.error(error); else console.log('OK', data);
  })();
  </script>
  -->
</body>
</html>